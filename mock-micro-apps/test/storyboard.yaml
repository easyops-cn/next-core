app:
  name: Test
  id: test
  homepage: /test
  # noAuthGuard: true
  # standaloneMode: true
meta:
  i18n:
    en:
      world: World!
    zh:
      world: 世界！
  functions:
  - name: sayYes
    source: |
      function sayYes() {
        console.log("sayYes() is called");
        return "yes~";
      }
  - name: sayYesYes
    typescript: true
    source: |
      function sayYesYes(): string {
        console.log("sayYesYes() is called");
        return `${FN.sayYes()} and ${FN.sayYes()}`;
      }
  customTemplates:
  - name: tpl-inner
    state:
    - name: innerHello
      expose: true
    bricks:
    - brick: span
      properties:
        textContent: '<% "track state", `Inner says ${STATE.innerHello}` %>'
  - name: tpl-basic
    state:
    - name: lazyHello
      resolve:
        useProvider: demo-basic.have-more-fun
        args:
        - |
          <% `I'm lazy (${STATE.hello})` %>
        - 1000
        lazy: true
      track: true
      onChange:
        action: console.log
        args:
        - state onChange
        - lazyHello
        - '<% EVENT.detail %>'
        - '<% 0, STATE.lazyHello %>'
    - name: hello
      value: Hello World
      onChange:
        action: console.log
        args:
        - state onChange
        - hello
        - '<% EVENT.detail %>'
        - '<% 0, STATE.hello %>'
      expose: true
    - name: asyncHello
      # if: false
      resolve:
        useProvider: demo-basic.have-more-fun
        args:
        - I'm async
        - 500
        - '<% Math.random() %>'
    proxy:
      properties:
        thing:
          ref: thingSpan
          refProperty: textContent
        status:
          ref: statusSpan
          refProperty: textContent
      slots:
        "":
          ref: container
      events:
        "yo":
          ref: thingSpan
          refEvent: click
    bricks:
    - brick: div
      ref: container
      children:
          - brick: span
            ref: thingSpan
            events:
              click:
                targetRef: inner
                properties:
                  innerHello: 'I say thing clicked'
          - brick: span
            ref: statusSpan
            lifeCycle:
              onPageLoad:
                action: tpl.dispatchEvent
                args:
                - oops
                - detail: yaks
            events:
              click:
              - action: console.log
                args:
                - status click
                - '<% EVENT.detail %>'
              - action: tpl.dispatchEvent
                args:
                - oops
                - detail: yaks
              - targetRef: buttons
                properties:
                  datum: d
          - brick: demo-basic.button-group
            ref: buttons
            properties:
              datum: c
              useBrick:
                brick: tpl-inner
                ref: inner
                properties:
                  innerHello: '<% `"I say ${DATA} and ${STATE.asyncHello}"` %>'
          # - brick: span
          #   properties:
          #     textContent: "<% 'track state', STATE.asyncHello %>"
          #   lifeCycle:
          #     onPageLoad:
          #     - action: console.log
          #       args:
          #       - "STATE.asyncHello"
          #       - "<% STATE.asyncHello %>"
          #     - action: state.load
          #       args:
          #       - lazyHello
          #       callback:
          #         success:
          #           action: console.log
          #           args:
          #           - lazyHello
          #           - "<% 1, STATE.lazyHello %>"
  - name: tpl-isolated
    proxy:
      slots:
        "":
          ref: content
          refSlot: ""
    state:
    - name: input
      value: '<% "input",JSON.stringify(ITEM) %>'
    bricks:
    - brick: ":forEach"
      dataSource:
      - Good
      - Better
      slots:
        "":
          bricks:
          - brick: span
            properties:
              textContent: 'ITEM should show: '
          - brick: span
            properties:
              textContent: '<% JSON.stringify(ITEM) %>'
              style:
                color: green
    - brick: span
      properties:
        textContent: 'ITEM should NOT show: '
    - brick: span
      properties:
        textContent: '<% JSON.stringify(ITEM) %>'
        style:
          color: red
    - brick: span
      properties:
        textContent: 'ITEM should NOT show: '
    - brick: span
      properties:
        textContent: '<% STATE.input %>'
        style:
          color: red
    - brick: div
      ref: content
      slots:
        "":
          bricks:
          - brick: ":forEach"
            dataSource: [1, 2]
            slots:
              "":
                bricks:
                - brick: span
                  properties:
                    textContent: '<% `<item:${ITEM}>` %>'
routes:
- path: ${APP.homepage}
  # if: '<% !QUERY.redirect %>'
  if: '${QUERY.redirect|not}'
  type: redirect
  redirect: '<% `${APP.homepage}?redirect=3` %>'
- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 1 %>'
  permissionsPreCheck:
  - abc
  - def
  context:
  - name: a
    value: 'a:b'
  - name: x
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      - 0
      transform:
        # value: '<% `{{${DATA}}}` %>'
        value: '{{{@{|add:"!"}}}}'
  - name: x
    if: '<% !CTX.r %>'
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      transform:
        value: '<% `{${DATA}}` %>'
  - name: y
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      - 0
      transform:
        value: '<% `「${DATA}」` %>'
    onChange:
      action: console.log
      args:
      - context changed
      - y
      - '<% EVENT.detail %>'
  - name: z
    value: '<% `z:${CTX.y}` %>'
    track: true
    onChange:
      action: console.log
      args:
      - context changed
      - z
      - '<% EVENT.detail %>'
  - name: r
    resolve:
      useProvider: demo-basic.have-fun
  - name: lazy
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '"lazy"'
      - 2000
      lazy: true
  bricks:
  - brick: basic.general-button
    properties:
      label: "Hi:"
    slots:
      "":
        type: bricks
        bricks:
        - brick: span
          properties:
            textContent: OK
  - brick: demo-basic.y-button
    properties:
      label: "Hello:"
      textContent: world
    events:
      oops:
      # - action: context.replace
      #   args:
      #   - y
      #   - '<% `clicked:${CTX.y}` %>'
      - action: context.refresh
        args:
        - y
        callback:
          success:
            action: console.log
            args:
            - context replaced
            - '<% EVENT.detail %>'
            - '<% CTX.y %>'
            - '<% CTX.z %>'
      - action: console.log
        args:
        - '<% EVENT.detail %>'
        - '<% CTX.x %>'
        async: true
      - action: console.log
        args:
        - '<% EVENT.detail %>'
        - immediately
  # - brick: demo-basic.y-button
  #   properties:
  #     label: "你好:"
  #     textContent: 世界
  - brick: demo-basic.button-group
  - brick: div
    properties:
      title: '<% CTX.y %>'
    slots:
      "":
        type: bricks
        bricks:
        # - brick: demo-form.f-input
        #   properties:
        #     label: "Name:"
        # - brick: demo-form.f-select
        #   permissionsPreCheck:
        #   - xyz
        #   properties:
        #     label: |
        #       <% `!Gender (${PROCESSORS.demoBasic.sayHello()},${FN.sayYesYes()}) <${CTX.x}>` %>
        - brick: span
          properties:
            textContent: |
              <%
                "track context",
                (PERMISSIONS.check("opq") ? "Yes" : "No"),
                `y:${CTX.y},z:${CTX.z}`
              %>
          lifeCycle:
            onBeforePageLeave:
            - action: history.block
              # if: |
              #   <% !PROCESSORS.demoBasic.sayHello() %>
              if: false
              args:
              - Oops
            - action: console.log
              args:
              - 'onBeforePageLeave'
              # - '<% PROCESSORS.demoBasic.sayHello() %>'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
            onBeforePageLoad:
            - action: console.log
              args:
              - 'onBeforePageLoad'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
            - action: theme.setTheme
              args:
              - dark-v2
            onPageLoad:
              action: console.log
              args:
              - 'onPageLoad'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
            onAnchorLoad:
              action: console.log
              args:
              - 'onAnchorLoad'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
            onAnchorUnload:
              action: console.log
              args:
              - 'onAnchorUnload'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
            onPageLeave:
              action: console.log
              args:
              - 'onPageLeave'
              - '<% EVENT %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
        - brick: a
          properties:
            textContent: Go outside
            href: '/oops'

  # - brick: demo-basic.have-fun
  # - brick: demo-basic.have-more-fun
  # - brick: demo-basic.have-no-fun
- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 2 %>'
  context:
  - name: datum
    value: a
  bricks:
  - brick: demo-basic.x-button
    if: false
    properties:
      label: X
    events:
      click:
        action: context.replace
        args:
        - datum
        - b
  - brick: demo-basic.button-group
    properties:
      datum: '<% "track context", CTX.datum %>'
      # useBrick:
      #   if: '<% DATA === "b" %>'
      #   brick: demo-basic.x-button
      #   properties:
      #     label: '<% `Label for "${DATA}"` %>'
      #     dataset:
      #       iid: 1
      #   slots:
      #     "":
      #       bricks:
      #       - brick: span
      #         properties:
      #           textContent: '<% `Content for "${DATA}"` %>'
      #           dataset:
      #             iid: 2
      useBrick:
        brick: tpl-basic
        # portal: true
        properties:
          thing: '<% `Thing for "${DATA}"` %>'
          status: '<% `Status for "${DATA}"` %>'
          hello: '<% `Hello for "${DATA}"` %>'
        events:
          yo:
            action: console.log
            args:
            - yo
            - '<% CTX.datum %>'
            - '<% DATA %>'
            - '<% EVENT %>'
        lifeCycle:
          onMount:
            action: console.log
            args:
            - onMount outer tpl-basic
            - '<% EVENT %>'
            - '<% DATA %>'
          onUnmount:
            action: console.log
            args:
            - onUnmount outer tpl-basic
            - '<% EVENT %>'
            - '<% DATA %>'
          onMediaChange:
            action: console.log
            args:
            - onMediaChange
            - '<% EVENT.detail.breakpoint %>'
            - '<% DATA %>'
          onScrollIntoView:
            handlers:
            - action: console.log
              args:
              - onScrollIntoView
              - '<% EVENT %>'
              - '<% DATA %>'
  - brick: tpl-basic
    # if: false
    properties:
      thing: Template
      status: Works!
      hello: 你好
    children:
        - brick: span
          properties:
            textContent: "~~"
            # textContent: "<% 0, STATE.hello %>"
    #       lifeCycle:
    #         onPageLoad:
    #           action: console.log
    #           args:
    #           - "1. STATE.hello"
    #           - "<% 1, STATE.hello %>"
    # lifeCycle:
    #   onPageLoad:
    #     action: console.log
    #     args:
    #     - "2. STATE.hello"
    #     - "<% 2, STATE.hello %>"
    events:
      yo:
        action: console.log
      oops:
        action: console.log

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 3 %>'
  bricks:
  - brick: demo-basic.button-with-icon
  - brick: icons.easyops-icon
    properties:
      # icon: account
      category: default
      icon: account
      style:
        color: red
        fontSize: 2em
  - brick: icons.fa-icon
    properties:
      prefix: regular
      icon: smile
      spin: true
      style:
        color: green
  - brick: icons.antd-icon
    properties:
      theme: outlined
      icon: aim
      style:
        color: blue
  - brick: icons.general-icon
    properties:
      lib: antd
      icon: branches
    events:
      click:
        action: console.log
  - brick: icons.general-icon
    properties:
      lib: fa
      prefix: regular
      icon: smile
  # - brick: basic.fa-icon
  #   properties:
  #     prefix: solid
  #     icon: user
  # - brick: span
  #   properties:
  #     class: "fa-solid fa-user"

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 4 %>'
  bricks:
  - brick: demo-widgets.tpl-first-template
  - brick: demo-widgets.tpl-second-template

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 5 %>'

  bricks:
  # 控制节点一：循环遍历
  - brick: ":forEach"
    # if: false
    dataSource:
    - title: A
      content: Hello
      list:
      - u
      - v
    - title: B
      content: World
      list:
      - x
      - y
    slots:
      # 保留插槽结构，以便兼容现有 Visual Builder 构件树的展示风格。
      # 同时以支持 if/else 和 switch 以及未来可能的其他控制节点的扩展。
      "":
        bricks:
        - brick: div
          properties:
            # 表达式提供一个 `ITEM` 的变量
            textContent: "<% ITEM.title %>"
        - brick: :forEach
          dataSource: "<% ITEM.list %>"
          slots:
            "":
              bricks:
              - brick: span
                properties:
                  textContent: "<% ITEM %>"
              - brick: tpl-isolated
        - brick: div
          properties:
            textContent: "<% ITEM.content %>"
        - brick: tpl-isolated
          slots:
            "":
              bricks:
              - brick: span
                properties:
                  textContent: 'ITEM should show <external of tpl>: '
              - brick: span
                iid: 'iid'
                properties:
                  textContent: '<% `Got: ${JSON.stringify(ITEM)}` %>'
                  style:
                    color: green

  # 控制节点二：条件判断
  - brick: ":if"
    # if: false
    dataSource: "<% false %>"
    slots:
      "":
        bricks:
        - brick: input
        - brick: textarea
      "else":
        bricks:
        - brick: button
        - brick: hr

  # # 控制节点三：条件选择
  - brick: ":switch"
    dataSource: |
      <%
        "b"
      %>
    slots:
      "a":
        bricks:
        - brick: input
        - brick: textarea
      "b":
        bricks:
        - brick: button
          properties:
            textContent: GO
          events:
            click:
              action: history.pushQuery
              args:
              - redirect: 6
        - brick: hr
          lifeCycle:
            onMount:
              action: console.log
            onUnmount:
              action: console.log

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 6 %>'
  context:
  - name: x
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - lazy
      - 3000
  type: redirect
  redirect: "<% CTX.x, `${APP.homepage}?redirect=7` %>"

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 7 %>'
  context:
  - name: x
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - lazy
      - 3000
  bricks:
  - brick: div
    properties:
      textContent: OK

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 8 %>'
  context:
  - name: world
    value:
      en: World
      zh: 世界
  bricks:
  - brick: demo-basic.say-hello
  - brick: demo-basic.native-button
  - brick: demo-basic.x-button
    properties:
      # label: '<% I18N_TEXT(CTX.world) %>'
      # label: '<% I18N("world") %>'
      label: '<% SYS.username %>'
    events:
      click:
        useProvider: easyops.api.cmdb.instance@ListInstance:1.0.0
        args:
        - HOST
        - page: 1
          page_size: 10
        callback:
          success:
            action: console.log
          error:
            action: console.error

- path: ${APP.homepage}
  if: '<% +QUERY.redirect === 9 %>'
  bricks:
  - brick: div
    if: false
    properties:
      textContent: v2-adapter
    _lifeCycle:
      onPageLoad:
        useProvider: v2-adapter.load-dll
  - brick: basic-bricks.app-bar
  - brick: basic-bricks.general-card
    # events:
    #   click:
    #     useProvider: next-builder.provider-get-brick-library
    #     args:
    #     - projectId: abc
    properties:
      style:
        padding: 20px
    children:
    - brick: div
      slot: content
      properties:
        style:
          display: grid
          gap: 10px
      children:
      - brick: basic-bricks.general-button
        properties:
          buttonName: I'm a v2 brick
          buttonType: danger
        events:
          general.button.click:
            action: console.log
      - brick: basic.general-button
        properties:
          textContent: "<% `I'm a v3 brick ${moment().format('MMM')}` %>"
          type: primary
        events:
          click:
            action: console.log
      - brick: basic-bricks.list-container
        properties:
          data:
          - a
          - b
          useBrick:
            brick: basic.general-button
            properties:
              textContent: '<% DATA %>'
      - brick: presentational-bricks.basic-icon
        properties:
          icon:
            lib: antd
            theme: outlined
            icon: branches
      - brick: presentational-bricks.basic-icon
        properties:
          icon:
            lib: fa
            prefix: fas
            icon: user
      - brick: presentational-bricks.basic-icon
        properties:
          icon:
            lib: easyops
            category: default
            icon: account
      - brick: presentational-bricks.brick-link
        properties:
          label: go
          url: "${APP.homepage}?redirect=8"
      - brick: presentational-bricks.cost-time
        properties:
          cost: 1200
      - brick: presentational-bricks.brick-table
        properties:
          rowKey: id
          showCard: false
          rowSelection: true
          hiddenColumns:
          - name
          columns:
          - title: Name
            dataIndex: name
            key: name
          - title: Age
            dataIndex: age
            key: age
          - dataIndex: address
            key: address
            headerBrick:
              useBrick:
                brick: presentational-bricks.general-tooltip
                properties:
                  icon:
                    lib: fa
                    icon: info-circle
                    color: var(--color-secondary-text)
                  content: 这是一个 tooltips
                  text: Address
          - title: Tags
            key: tags
            dataIndex: tags
            useBrick:
              brick: presentational-bricks.brick-tag
              properties:
                showCard: false
                tagList: "<% DATA.cellData %>"
                configProps:
                  color: var(--color-brand)
          dataSource:
            list:
            - id: '1'
              name: John Brown
              age: 32
              address: New York No. 1 Lake Park
              tags:
              - nice
              - good
            - id: '2'
              name: Jim Green
              age: 42
              address: London No. 1 Lake Park
              tags:
              - loser
              - bad
            page: 1
            pageSize: 10
            total: 2
        events:
          select.update:
            action: console.log
          select.update.args:
            action: console.log
          filter.update:
            action: console.log
          page.update:
            action: console.log
      - brick: time.task-calendar
        events:
          calendar.onPanelChange:
            - action: console.log
              args:
                - '${EVENT.detail}'
          calendar.onSelect:
            - action: console.log
              args:
                - '${EVENT.detail}'
        properties:
          briefList:
            - date: 2021-06-13
              text: 休
            - date: 2021-06-12
              text: 休
            - date: 2021-06-14
              text: 休
          importanceSettings:
            colorMap:
              两会: var(--theme-cyan-color)
              人行窗口: var(--theme-geekblue-color)
              发版: var(--theme-green-color)
            priority:
              - 发版
              - 两会
              - 人行窗口
          importantList:
            - date: 2021-06-01
              issues:
                - 发版
            - date: 2021-06-02
              issues: []
            - date: 2021-06-03
              issues:
                - 人行窗口
                - 两会
          style:
            width: 500px
          taskList:
            - date: 2021-06-20
              task:
                - OPT_CHANGE_NUMBER: '001'
                  OPT_NOTIFICATION_TM: '2021-05-01 09:00:00'
                  OPT_PRIORITY_ID: '3'
                  OPT_SUMMARY: XBUS系统月度巡检
                  url: /test?id=001
                - OPT_CHANGE_NUMBER: '002'
                  OPT_NOTIFICATION_TM: '2021-05-01 10:00:00'
                  OPT_PRIORITY_ID: '3'
                  OPT_SUMMARY: ESB系统月度巡检
                  url: /test?id=002
                - OPT_CHANGE_NUMBER: '003'
                  OPT_NOTIFICATION_TM: '2021-05-01 10:00:00'
                  OPT_PRIORITY_ID: '2'
                  OPT_SUMMARY: 新同城数据中心EBUS部署
            - date: 2021-06-02
              task:
                - OPT_CHANGE_NUMBER: '004'
                  OPT_NOTIFICATION_TM: '2021-05-01 10:00:00'
                  OPT_PRIORITY_ID: '1'
                  OPT_SUMMARY: EBUS系统老中心WAS漏洞修复工作
            - date: 2021-06-03
              task: []
          taskSettings:
            colorMap:
              '0': var(--theme-red-color)
              '1': var(--theme-orange-color)
              '2': var(--theme-purple-color)
              '3': var(--theme-green-color)
            fields:
              priority: OPT_PRIORITY_ID
              summary: OPT_SUMMARY
              time: OPT_NOTIFICATION_TM
            taskTitle: 运维任务
          value: 2021-06-20
      - brick: presentational-bricks.markdown-display
        properties:
          value: |
            ### 三级标题

            - 列表1
            - 列表2
            - 列表3
