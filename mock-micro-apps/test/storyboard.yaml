app:
  name: Test
  id: test
  homepage: /
  noAuthGuard: true
meta:
  functions:
  - name: sayYes
    source: |
      function sayYes() {
        console.log("sayYes() is called");
        return "yes~";
      }
  - name: sayYesYes
    typescript: true
    source: |
      function sayYesYes(): string {
        console.log("sayYesYes() is called");
        return `${FN.sayYes()} and ${FN.sayYes()}`;
      }
routes:
- path: ${APP.homepage}
  # if: '<% !QUERY.redirect %>'
  if: '${QUERY.redirect|not}'
  type: redirect
  redirect: '<% "/?redirect=1" %>'
- path: ${APP.homepage}
  if: '<% QUERY.redirect %>'
  permissionsPreCheck:
  - abc
  - def
  context:
  - name: a
    value: 'a:b'
  - name: x
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      - 0
      transform:
        # value: '<% `{{${DATA}}}` %>'
        value: '{{{@{|add:"!"}}}}'
  - name: x
    if: '<% !CTX.r %>'
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      transform:
        value: '<% `{${DATA}}` %>'
  - name: y
    resolve:
      useProvider: demo-basic.have-more-fun
      args:
      - '<% CTX.r %>'
      - 0
      transform:
        value: '<% `「${DATA}」` %>'
    onChange:
      action: console.log
      args:
      - context changed
      - y
      - '<% EVENT.detail %>'
  - name: z
    value: '<% `z:${CTX.y}` %>'
    track: true
    onChange:
      action: console.log
      args:
      - context changed
      - z
      - '<% EVENT.detail %>'
  - name: r
    resolve:
      useProvider: demo-basic.have-fun
  bricks:
    - brick: basic.demo-button
      properties:
        label: "Hi:"
      slots:
        "":
          type: bricks
          bricks:
          - brick: span
            properties:
              textContent: OK
    - brick: demo-basic.y-button
      properties:
        label: "Hello:"
        textContent: world
      events:
        oops:
        # - action: context.replace
        #   args:
        #   - y
        #   - '<% `clicked:${CTX.y}` %>'
        - action: context.refresh
          args:
          - y
          callback:
            success:
              action: console.log
              args:
              - context replaced
              - '<% EVENT.detail %>'
              - '<% CTX.y %>'
              - '<% CTX.z %>'
        - action: console.log
          args:
          - '<% EVENT.detail %>'
          - '<% CTX.x %>'
          async: true
        - action: console.log
          args:
          - '<% EVENT.detail %>'
          - immediately
    # - brick: demo-basic.y-button
    #   properties:
    #     label: "你好:"
    #     textContent: 世界
    - brick: demo-basic.button-group
    - brick: div
      properties:
        title: '<% CTX.y %>'
      slots:
        "":
          type: bricks
          bricks:
          - brick: demo-form.f-input
            properties:
              label: "Name:"
          - brick: demo-form.f-select
            permissionsPreCheck:
            - xyz
            properties:
              label: |
                <% `!Gender (${PROCESSORS.demoBasic.sayHello()},${FN.sayYesYes()}) <${CTX.x}>` %>
          - brick: span
            properties:
              textContent: |
                <%
                  PERMISSIONS.check("opq") ? "Yes" : "No"
                %>
    # - brick: demo-basic.have-fun
    # - brick: demo-basic.have-more-fun
    # - brick: demo-basic.have-no-fun
